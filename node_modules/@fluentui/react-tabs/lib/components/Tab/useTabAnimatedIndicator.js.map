{"version":3,"names":["React","__styles","mergeClasses","shorthands","useTabListContext_unstable","tokens","tabIndicatorCssVars_unstable","offsetVar","scaleVar","useActiveIndicatorStyles","base","B68tc82","Bmxbyg5","animated","Ba2ppi3","F2fol1","B1dyfl9","B0vmy72","u9bimw","horizontal","sjv3b2","b1kco5","vertical","d","m","calculateTabRect","element","_element_parentElement","parentRect","parentElement","getBoundingClientRect","x","y","width","height","tabRect","undefined","getRegisteredTabRect","registeredTabs","value","_registeredTabs_JSON_stringify","JSON","stringify","ref","current","useTabAnimatedIndicatorStyles_unstable","state","disabled","selected","activeIndicatorStyles","lastAnimatedFrom","setLastAnimatedFrom","useState","animationValues","setAnimationValues","offset","scale","getRegisteredTabs","ctx","useEffect","previousSelectedValue","selectedValue","previousSelectedTabRect","selectedTabRect","animating","root","className","rootCssVars","style"],"sources":["../../../src/components/Tab/useTabAnimatedIndicator.ts"],"sourcesContent":["import * as React from 'react';\nimport type { TabState, TabValue } from './Tab.types';\n\nimport { makeStyles, mergeClasses, shorthands } from '@griffel/react';\nimport { useTabListContext_unstable } from '../TabList/TabListContext';\nimport { TabRegisterData } from '../TabList/TabList.types';\nimport { tokens } from '@fluentui/react-theme';\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nconst tabIndicatorCssVars_unstable = {\n  offsetVar: '--fui-Tab__indicator--offset',\n  scaleVar: '--fui-Tab__indicator--scale',\n};\n\nconst useActiveIndicatorStyles = makeStyles({\n  base: {\n    // overflow is required to allow the selection indicator to animate outside the tab area.\n    ...shorthands.overflow('visible'),\n  },\n  animated: {\n    '::after': {\n      transitionProperty: 'transform',\n      transitionDuration: `${tokens.durationSlow}`,\n      transitionTimingFunction: `${tokens.curveDecelerateMax}`,\n    },\n    '@media (prefers-reduced-motion: reduce)': {\n      '::after': {\n        transitionProperty: 'none',\n        transitionDuration: '0.01ms',\n      },\n    },\n  },\n  horizontal: {\n    '::after': {\n      transformOrigin: 'left',\n      transform: `translateX(var(${tabIndicatorCssVars_unstable.offsetVar}))\n    scaleX(var(${tabIndicatorCssVars_unstable.scaleVar}))`,\n    },\n  },\n  vertical: {\n    '::after': {\n      transformOrigin: 'top',\n      transform: `translateY(var(${tabIndicatorCssVars_unstable.offsetVar}))\n        scaleY(var(${tabIndicatorCssVars_unstable.scaleVar}))`,\n    },\n  },\n});\n\nconst calculateTabRect = (element: HTMLElement) => {\n  if (element) {\n    const parentRect = element.parentElement?.getBoundingClientRect() || { x: 0, y: 0, width: 0, height: 0 };\n    const tabRect = element.getBoundingClientRect();\n\n    return {\n      x: tabRect.x - parentRect.x,\n      y: tabRect.y - parentRect.y,\n      width: tabRect.width,\n      height: tabRect.height,\n    };\n  }\n  return undefined;\n};\n\nconst getRegisteredTabRect = (registeredTabs: Record<string, TabRegisterData>, value?: TabValue) => {\n  const element =\n    value !== undefined && value !== null ? registeredTabs[JSON.stringify(value)]?.ref.current : undefined;\n  return element ? calculateTabRect(element) : undefined;\n};\n\n/**\n * Adds additional styling to the active tab selection indicator to create a sliding animation.\n */\nexport const useTabAnimatedIndicatorStyles_unstable = (state: TabState): TabState => {\n  const { disabled, selected, vertical } = state;\n\n  const activeIndicatorStyles = useActiveIndicatorStyles();\n  const [lastAnimatedFrom, setLastAnimatedFrom] = React.useState<TabValue>();\n  const [animationValues, setAnimationValues] = React.useState({ offset: 0, scale: 1 });\n  const getRegisteredTabs = useTabListContext_unstable(ctx => ctx.getRegisteredTabs);\n\n  React.useEffect(() => {\n    if (lastAnimatedFrom) {\n      setAnimationValues({ offset: 0, scale: 1 });\n    }\n  }, [lastAnimatedFrom]);\n\n  if (selected) {\n    const { previousSelectedValue, selectedValue, registeredTabs } = getRegisteredTabs();\n    const previousSelectedTabRect = getRegisteredTabRect(registeredTabs, previousSelectedValue);\n    const selectedTabRect = getRegisteredTabRect(registeredTabs, selectedValue);\n\n    if (\n      selectedTabRect &&\n      previousSelectedTabRect &&\n      previousSelectedValue &&\n      lastAnimatedFrom !== previousSelectedValue\n    ) {\n      const offset = vertical\n        ? previousSelectedTabRect.y - selectedTabRect.y\n        : previousSelectedTabRect.x - selectedTabRect.x;\n\n      const scale = vertical\n        ? previousSelectedTabRect.height / selectedTabRect.height\n        : previousSelectedTabRect.width / selectedTabRect.width;\n\n      setAnimationValues({ offset, scale });\n      setLastAnimatedFrom(previousSelectedValue);\n    }\n  } else if (lastAnimatedFrom) {\n    // need to clear the last animated from so that if this tab is selected again\n    // from the same previous tab as last time, that animation still happens.\n    setLastAnimatedFrom(undefined);\n  }\n\n  // do not apply any animation if the tab is disabled\n  if (disabled) {\n    return state;\n  }\n\n  // the animation should only happen as the selection indicator returns to its\n  // original position and not when set at the previous tabs position.\n  const animating = animationValues.offset === 0 && animationValues.scale === 1;\n\n  state.root.className = mergeClasses(\n    state.root.className,\n    selected && activeIndicatorStyles.base,\n    selected && animating && activeIndicatorStyles.animated,\n    selected && (vertical ? activeIndicatorStyles.vertical : activeIndicatorStyles.horizontal),\n  );\n\n  const rootCssVars = {\n    [tabIndicatorCssVars_unstable.offsetVar]: `${animationValues.offset}px`,\n    [tabIndicatorCssVars_unstable.scaleVar]: `${animationValues.scale}`,\n  };\n\n  state.root.style = {\n    ...rootCssVars,\n    ...state.root.style,\n  };\n\n  return state;\n};\n"],"mappings":"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"}