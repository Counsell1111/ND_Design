{"version":3,"names":["React","useOptionCollection","nodes","useRef","collectionAPI","useMemo","getCount","current","length","getOptionAtIndex","index","_nodes_current_index","option","getIndexOfId","id","findIndex","node","getOptionById","item","find","getOptionsMatchingText","matcher","filter","text","map","getOptionsMatchingValue","value","registerOption","useCallback","element","compareDocumentPosition","Node","DOCUMENT_POSITION_PRECEDING","newItem","splice","options"],"sources":["../../src/utils/useOptionCollection.ts"],"sourcesContent":["import * as React from 'react';\nimport type { OptionCollectionState, OptionValue } from './OptionCollection.types';\n\n/**\n * A hook for managing a collection of child Options\n */\nexport const useOptionCollection = (): OptionCollectionState => {\n  const nodes = React.useRef<{ option: OptionValue; element: HTMLElement }[]>([]);\n\n  const collectionAPI = React.useMemo(() => {\n    const getCount = () => nodes.current.length;\n    const getOptionAtIndex = (index: number) => nodes.current[index]?.option;\n    const getIndexOfId = (id: string) => nodes.current.findIndex(node => node.option.id === id);\n    const getOptionById = (id: string) => {\n      const item = nodes.current.find(node => node.option.id === id);\n      return item?.option;\n    };\n    const getOptionsMatchingText = (matcher: (text: string) => boolean) => {\n      return nodes.current.filter(node => matcher(node.option.text)).map(node => node.option);\n    };\n    const getOptionsMatchingValue = (matcher: (value: string) => boolean) => {\n      return nodes.current.filter(node => matcher(node.option.value)).map(node => node.option);\n    };\n\n    return {\n      getCount,\n      getOptionAtIndex,\n      getIndexOfId,\n      getOptionById,\n      getOptionsMatchingText,\n      getOptionsMatchingValue,\n    };\n  }, []);\n\n  const registerOption = React.useCallback((option: OptionValue, element: HTMLElement) => {\n    const index = nodes.current.findIndex(node => {\n      if (!node.element || !element) {\n        return false;\n      }\n\n      if (node.option.id === option.id) {\n        return true;\n      }\n\n      // use the DOM method compareDocumentPosition to order the current node against registered nodes\n      // eslint-disable-next-line no-bitwise\n      return node.element.compareDocumentPosition(element) & Node.DOCUMENT_POSITION_PRECEDING;\n    });\n\n    // do not register the option if it already exists\n    if (nodes.current[index]?.option.id !== option.id) {\n      const newItem = {\n        element,\n        option,\n      };\n\n      // If an index is not found we will push the element to the end.\n      if (index === -1) {\n        nodes.current = [...nodes.current, newItem];\n      } else {\n        nodes.current.splice(index, 0, newItem);\n      }\n    }\n\n    // return the unregister function\n    return () => {\n      nodes.current = nodes.current.filter(node => node.option.id !== option.id);\n    };\n  }, []);\n\n  return {\n    ...collectionAPI,\n    options: nodes.current.map(node => node.option),\n    registerOption,\n  };\n};\n"],"mappings":"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"}