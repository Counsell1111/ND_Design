{"version":3,"names":["React","useMenuContext_unstable","useIsSubmenu","useFocusFinders","useFluent_unstable","useFluent","ArrowRight","ArrowLeft","Escape","ArrowDown","applyTriggerPropsToChildren","getTriggerChild","isHTMLElement","mergeCallbacks","useEventCallback","useMergedRefs","useARIAButtonProps","useMenuTrigger_unstable","props","children","disableButtonEnhancement","triggerRef","context","menuPopoverRef","setOpen","open","triggerId","openOnHover","openOnContext","isSubmenu","findFirstFocusable","focusFirst","useCallback","firstFocusable","current","focus","openedWithKeyboardRef","useRef","hasMouseMoved","dir","OpenArrowKey","child","onContextMenu","event","isTargetDisabled","preventDefault","keyboard","type","onClick","onKeyDown","key","onMouseEnter","onMouseMove","onMouseLeave","contextMenuProps","id","ref","triggerChildProps","undefined","ariaButtonTriggerChildProps","isDisabled","el","hasAttribute","getAttribute","target","currentTarget"],"sources":["../../../src/components/MenuTrigger/useMenuTrigger.ts"],"sourcesContent":["import * as React from 'react';\nimport { MenuTriggerProps, MenuTriggerState } from './MenuTrigger.types';\nimport { useMenuContext_unstable } from '../../contexts/menuContext';\nimport { useIsSubmenu } from '../../utils/useIsSubmenu';\nimport { useFocusFinders } from '@fluentui/react-tabster';\nimport { useFluent_unstable as useFluent } from '@fluentui/react-shared-contexts';\nimport { ArrowRight, ArrowLeft, Escape, ArrowDown } from '@fluentui/keyboard-keys';\nimport {\n  applyTriggerPropsToChildren,\n  getTriggerChild,\n  isHTMLElement,\n  mergeCallbacks,\n  useEventCallback,\n  useMergedRefs,\n} from '@fluentui/react-utilities';\nimport { useARIAButtonProps } from '@fluentui/react-aria';\n\n/**\n * Create the state required to render MenuTrigger.\n * Clones the only child component and adds necessary event handling behaviours to open a popup menu\n *\n * @param props - props from this instance of MenuTrigger\n */\nexport const useMenuTrigger_unstable = (props: MenuTriggerProps): MenuTriggerState => {\n  const { children, disableButtonEnhancement = false } = props;\n\n  const triggerRef = useMenuContext_unstable(context => context.triggerRef);\n  const menuPopoverRef = useMenuContext_unstable(context => context.menuPopoverRef);\n  const setOpen = useMenuContext_unstable(context => context.setOpen);\n  const open = useMenuContext_unstable(context => context.open);\n  const triggerId = useMenuContext_unstable(context => context.triggerId);\n  const openOnHover = useMenuContext_unstable(context => context.openOnHover);\n  const openOnContext = useMenuContext_unstable(context => context.openOnContext);\n\n  const isSubmenu = useIsSubmenu();\n\n  const { findFirstFocusable } = useFocusFinders();\n  const focusFirst = React.useCallback(() => {\n    const firstFocusable = findFirstFocusable(menuPopoverRef.current);\n    firstFocusable?.focus();\n  }, [findFirstFocusable, menuPopoverRef]);\n\n  const openedWithKeyboardRef = React.useRef(false);\n  const hasMouseMoved = React.useRef(false);\n\n  const { dir } = useFluent();\n  const OpenArrowKey = dir === 'ltr' ? ArrowRight : ArrowLeft;\n\n  const child = getTriggerChild(children);\n\n  const onContextMenu = (event: React.MouseEvent<HTMLButtonElement & HTMLAnchorElement & HTMLDivElement>) => {\n    if (isTargetDisabled(event)) {\n      return;\n    }\n\n    if (openOnContext) {\n      event.preventDefault();\n      setOpen(event, { open: true, keyboard: false, type: 'menuTriggerContextMenu', event });\n    }\n  };\n\n  const onClick = (event: React.MouseEvent<HTMLButtonElement & HTMLAnchorElement & HTMLDivElement>) => {\n    if (isTargetDisabled(event)) {\n      return;\n    }\n\n    if (!openOnContext) {\n      setOpen(event, { open: !open, keyboard: openedWithKeyboardRef.current, type: 'menuTriggerClick', event });\n      openedWithKeyboardRef.current = false;\n    }\n  };\n\n  const onKeyDown = (event: React.KeyboardEvent<HTMLButtonElement & HTMLAnchorElement & HTMLDivElement>) => {\n    if (isTargetDisabled(event)) {\n      return;\n    }\n\n    const key = event.key;\n\n    if (!openOnContext && ((isSubmenu && key === OpenArrowKey) || (!isSubmenu && key === ArrowDown))) {\n      setOpen(event, { open: true, keyboard: true, type: 'menuTriggerKeyDown', event });\n    }\n\n    if (key === Escape && !isSubmenu) {\n      setOpen(event, { open: false, keyboard: true, type: 'menuTriggerKeyDown', event });\n    }\n\n    // if menu is already open, can't rely on effects to focus\n    if (open && key === OpenArrowKey && isSubmenu) {\n      focusFirst();\n    }\n  };\n\n  const onMouseEnter = (event: React.MouseEvent<HTMLButtonElement & HTMLAnchorElement & HTMLDivElement>) => {\n    if (isTargetDisabled(event)) {\n      return;\n    }\n    if (openOnHover && hasMouseMoved.current) {\n      setOpen(event, { open: true, keyboard: false, type: 'menuTriggerMouseEnter', event });\n    }\n  };\n\n  // Opening a menu when a mouse hasn't moved and just entering the trigger is a bad a11y experience\n  // First time open the mouse using mousemove and then continue with mouseenter\n  // Only use once to determine that the user is using the mouse since it is an expensive event to handle\n  const onMouseMove = (event: React.MouseEvent<HTMLButtonElement & HTMLAnchorElement & HTMLDivElement>) => {\n    if (isTargetDisabled(event)) {\n      return;\n    }\n    if (openOnHover && !hasMouseMoved.current) {\n      setOpen(event, { open: true, keyboard: false, type: 'menuTriggerMouseMove', event });\n      hasMouseMoved.current = true;\n    }\n  };\n\n  const onMouseLeave = (event: React.MouseEvent<HTMLButtonElement & HTMLAnchorElement & HTMLDivElement>) => {\n    if (isTargetDisabled(event)) {\n      return;\n    }\n    if (openOnHover) {\n      setOpen(event, { open: false, keyboard: false, type: 'menuTriggerMouseLeave', event });\n    }\n  };\n\n  const contextMenuProps = {\n    id: triggerId,\n    ...child?.props,\n    ref: useMergedRefs(triggerRef, child?.ref),\n    onMouseEnter: useEventCallback(mergeCallbacks(child?.props.onMouseEnter, onMouseEnter)),\n    onMouseLeave: useEventCallback(mergeCallbacks(child?.props.onMouseLeave, onMouseLeave)),\n    onContextMenu: useEventCallback(mergeCallbacks(child?.props.onContextMenu, onContextMenu)),\n    onMouseMove: useEventCallback(mergeCallbacks(child?.props.onMouseMove, onMouseMove)),\n  };\n\n  const triggerChildProps = {\n    'aria-haspopup': 'menu',\n    'aria-expanded': !open && !isSubmenu ? undefined : open,\n    ...contextMenuProps,\n    onClick: useEventCallback(mergeCallbacks(child?.props.onClick, onClick)),\n    onKeyDown: useEventCallback(mergeCallbacks(child?.props.onKeyDown, onKeyDown)),\n  } as const;\n\n  const ariaButtonTriggerChildProps = useARIAButtonProps(\n    child?.type === 'button' || child?.type === 'a' ? child.type : 'div',\n    triggerChildProps,\n  );\n\n  return {\n    isSubmenu,\n    children: applyTriggerPropsToChildren(\n      children,\n      openOnContext ? contextMenuProps : disableButtonEnhancement ? triggerChildProps : ariaButtonTriggerChildProps,\n    ),\n  };\n};\n\nconst isTargetDisabled = (event: React.SyntheticEvent | Event) => {\n  const isDisabled = (el: HTMLElement) =>\n    el.hasAttribute('disabled') || (el.hasAttribute('aria-disabled') && el.getAttribute('aria-disabled') === 'true');\n  if (isHTMLElement(event.target) && isDisabled(event.target)) {\n    return true;\n  }\n\n  return isHTMLElement(event.currentTarget) && isDisabled(event.currentTarget);\n};\n"],"mappings":"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"}