{"version":3,"names":["React","useArrowNavigationGroup","useFocusFinders","useTable_unstable","useTableFeatures","useTableSort","useTableSelection","useTableColumnSizing_unstable","CELL_WIDTH","useEventCallback","useMergedRefs","End","Home","useDataGrid_unstable","props","ref","items","columns","focusMode","selectionMode","onSortChange","onSelectionChange","defaultSortState","sortState","selectedItems","defaultSelectedItems","subtleSelection","selectionAppearance","getRowId","resizableColumns","columnSizingOptions","onColumnResize","navigable","keyboardNavAttr","axis","tableState","containerWidthOffset","innerRef","useRef","findFirstFocusable","findLastFocusable","onKeyDown","e","_props_onKeyDown","call","current","ctrlKey","defaultPrevented","key","firstRow","querySelector","_findFirstFocusable","focus","rows","querySelectorAll","length","_findLastFocusable","lastRow","item","baseTableState","role","as","noNativeElements","tableRef","selectableRows"],"sources":["../../../src/components/DataGrid/useDataGrid.ts"],"sourcesContent":["import * as React from 'react';\nimport { useArrowNavigationGroup, useFocusFinders } from '@fluentui/react-tabster';\nimport type { DataGridProps, DataGridState } from './DataGrid.types';\nimport { useTable_unstable } from '../Table/useTable';\nimport { useTableFeatures, useTableSort, useTableSelection, useTableColumnSizing_unstable } from '../../hooks';\nimport { CELL_WIDTH } from '../TableSelectionCell';\nimport { useEventCallback, useMergedRefs } from '@fluentui/react-utilities';\nimport { End, Home } from '@fluentui/keyboard-keys';\n\n/**\n * Create the state required to render DataGrid.\n *\n * The returned state can be modified with hooks such as useDataGridStyles_unstable,\n * before being passed to renderDataGrid_unstable.\n *\n * @param props - props from this instance of DataGrid\n * @param ref - reference to root HTMLElement of DataGrid\n */\nexport const useDataGrid_unstable = (props: DataGridProps, ref: React.Ref<HTMLElement>): DataGridState => {\n  const {\n    items,\n    columns,\n    focusMode = 'cell',\n    selectionMode,\n    onSortChange,\n    onSelectionChange,\n    defaultSortState,\n    sortState,\n    selectedItems,\n    defaultSelectedItems,\n    subtleSelection = false,\n    selectionAppearance = 'brand',\n    getRowId,\n    resizableColumns,\n    columnSizingOptions,\n    onColumnResize,\n  } = props;\n\n  const navigable = focusMode !== 'none';\n  const keyboardNavAttr = useArrowNavigationGroup({\n    axis: 'grid',\n  });\n\n  const tableState = useTableFeatures({ items, columns, getRowId }, [\n    useTableSort({\n      defaultSortState,\n      sortState,\n      onSortChange,\n    }),\n    useTableSelection({\n      defaultSelectedItems,\n      selectedItems,\n      onSelectionChange,\n      selectionMode: selectionMode ?? 'multiselect',\n    }),\n    useTableColumnSizing_unstable({\n      onColumnResize,\n      columnSizingOptions,\n      // The selection cell is not part of the columns, therefore its width needs to be subtracted\n      // from the container to make sure the columns don't overflow the table.\n      containerWidthOffset: selectionMode ? -CELL_WIDTH : 0,\n    }),\n  ]);\n\n  const innerRef = React.useRef<HTMLDivElement>(null);\n  const { findFirstFocusable, findLastFocusable } = useFocusFinders();\n  const onKeyDown = useEventCallback((e: React.KeyboardEvent<HTMLTableElement>) => {\n    props.onKeyDown?.(e);\n    if (!innerRef.current || !e.ctrlKey || e.defaultPrevented) {\n      return;\n    }\n\n    if (e.key === Home) {\n      const firstRow = innerRef.current.querySelector('[role=\"row\"]') as HTMLElement | null;\n      if (firstRow) {\n        findFirstFocusable(firstRow)?.focus();\n      }\n    }\n\n    if (e.key === End) {\n      const rows = innerRef.current.querySelectorAll('[role=\"row\"]');\n      if (rows.length) {\n        const lastRow = rows.item(rows.length - 1);\n        findLastFocusable(lastRow as HTMLElement)?.focus();\n      }\n    }\n  });\n\n  const baseTableState = useTable_unstable(\n    {\n      role: 'grid',\n      as: 'div',\n      noNativeElements: true,\n      ...(navigable && keyboardNavAttr),\n      ...props,\n      onKeyDown,\n    },\n    useMergedRefs(ref, tableState.tableRef, innerRef),\n  );\n\n  return {\n    ...baseTableState,\n    focusMode,\n    tableState,\n    selectableRows: !!selectionMode,\n    subtleSelection,\n    selectionAppearance,\n    resizableColumns,\n  };\n};\n"],"mappings":"AAAA,YAAYA,KAAA,MAAW;AACvB,SAASC,uBAAuB,EAAEC,eAAe,QAAQ;AAEzD,SAASC,iBAAiB,QAAQ;AAClC,SAASC,gBAAgB,EAAEC,YAAY,EAAEC,iBAAiB,EAAEC,6BAA6B,QAAQ;AACjG,SAASC,UAAU,QAAQ;AAC3B,SAASC,gBAAgB,EAAEC,aAAa,QAAQ;AAChD,SAASC,GAAG,EAAEC,IAAI,QAAQ;AAE1B;;;;;;;;;AASA,OAAO,MAAMC,oBAAA,GAAuBA,CAACC,KAAA,EAAsBC,GAAA,KAA+C;EACxG,MAAM;IACJC,KAAA;IACAC,OAAA;IACAC,SAAA,GAAY;IACZC,aAAA;IACAC,YAAA;IACAC,iBAAA;IACAC,gBAAA;IACAC,SAAA;IACAC,aAAA;IACAC,oBAAA;IACAC,eAAA,GAAkB,KAAK;IACvBC,mBAAA,GAAsB;IACtBC,QAAA;IACAC,gBAAA;IACAC,mBAAA;IACAC;EAAc,CACf,GAAGjB,KAAA;EAEJ,MAAMkB,SAAA,GAAYd,SAAA,KAAc;EAChC,MAAMe,eAAA,GAAkBhC,uBAAA,CAAwB;IAC9CiC,IAAA,EAAM;EACR;EAEA,MAAMC,UAAA,GAAa/B,gBAAA,CAAiB;IAAEY,KAAA;IAAOC,OAAA;IAASW;EAAS,GAAG,CAChEvB,YAAA,CAAa;IACXiB,gBAAA;IACAC,SAAA;IACAH;EACF,IACAd,iBAAA,CAAkB;IAChBmB,oBAAA;IACAD,aAAA;IACAH,iBAAA;IACAF,aAAA,EAAeA,aAAA,aAAAA,aAAA,cAAAA,aAAA,GAAiB;EAClC,IACAZ,6BAAA,CAA8B;IAC5BwB,cAAA;IACAD,mBAAA;IACA;IACA;IACAM,oBAAA,EAAsBjB,aAAA,GAAgB,CAACX,UAAA,GAAa;EACtD,GACD;EAED,MAAM6B,QAAA,GAAWrC,KAAA,CAAMsC,MAAM,CAAiB,IAAI;EAClD,MAAM;IAAEC,kBAAA;IAAoBC;EAAiB,CAAE,GAAGtC,eAAA;EAClD,MAAMuC,SAAA,GAAYhC,gBAAA,CAAkBiC,CAAA,IAA6C;QAC/EC,gBAAA;IAAA,CAAAA,gBAAA,GAAA7B,KAAA,CAAM2B,SAAS,cAAfE,gBAAA,uBAAAA,gBAAA,CAAAC,IAAA,CAAA9B,KAAA,EAAkB4B,CAAA;IAClB,IAAI,CAACL,QAAA,CAASQ,OAAO,IAAI,CAACH,CAAA,CAAEI,OAAO,IAAIJ,CAAA,CAAEK,gBAAgB,EAAE;MACzD;IACF;IAEA,IAAIL,CAAA,CAAEM,GAAG,KAAKpC,IAAA,EAAM;MAClB,MAAMqC,QAAA,GAAWZ,QAAA,CAASQ,OAAO,CAACK,aAAa,CAAC;MAChD,IAAID,QAAA,EAAU;YACZE,mBAAA;QAAA,CAAAA,mBAAA,GAAAZ,kBAAA,CAAmBU,QAAA,eAAnBE,mBAAA,uBAAAA,mBAAA,CAA8BC,KAAA;MAChC;IACF;IAEA,IAAIV,CAAA,CAAEM,GAAG,KAAKrC,GAAA,EAAK;MACjB,MAAM0C,IAAA,GAAOhB,QAAA,CAASQ,OAAO,CAACS,gBAAgB,CAAC;MAC/C,IAAID,IAAA,CAAKE,MAAM,EAAE;YAEfC,kBAAA;QADA,MAAMC,OAAA,GAAUJ,IAAA,CAAKK,IAAI,CAACL,IAAA,CAAKE,MAAM,GAAG;QACxC,CAAAC,kBAAA,GAAAhB,iBAAA,CAAkBiB,OAAA,eAAlBD,kBAAA,uBAAAA,kBAAA,CAA2CJ,KAAA;MAC7C;IACF;EACF;EAEA,MAAMO,cAAA,GAAiBxD,iBAAA,CACrB;IACEyD,IAAA,EAAM;IACNC,EAAA,EAAI;IACJC,gBAAA,EAAkB,IAAI;IACtB,IAAI9B,SAAA,IAAaC,eAAe;IAChC,GAAGnB,KAAK;IACR2B;EACF,GACA/B,aAAA,CAAcK,GAAA,EAAKoB,UAAA,CAAW4B,QAAQ,EAAE1B,QAAA;EAG1C,OAAO;IACL,GAAGsB,cAAc;IACjBzC,SAAA;IACAiB,UAAA;IACA6B,cAAA,EAAgB,CAAC,CAAC7C,aAAA;IAClBO,eAAA;IACAC,mBAAA;IACAE;EACF;AACF"}