{"version":3,"names":["useId","useIsomorphicLayoutEffect","React","fluentProviderClassNames","useInsertionEffect","createStyleTag","target","elementAttributes","undefined","tag","createElement","Object","keys","forEach","attrName","setAttribute","head","appendChild","insertSheet","rule","sheet","cssRules","length","deleteRule","insertRule","process","env","NODE_ENV","console","error","useFluentProviderThemeStyleTag","options","targetDocument","theme","rendererAttributes","styleTag","useRef","styleTagId","root","styleElementAttributes","cssVarsAsString","useMemo","reduce","cssVarRule","cssVar","useHandleSSRStyleElements","ssrStyleElement","getElementById","current","id","_styleTag_current","remove","useState","themeStyleElement","append"],"sources":["../../../src/components/FluentProvider/useFluentProviderThemeStyleTag.ts"],"sourcesContent":["import { useId, useIsomorphicLayoutEffect } from '@fluentui/react-utilities';\nimport * as React from 'react';\n\nimport type { FluentProviderState } from './FluentProvider.types';\nimport { fluentProviderClassNames } from './useFluentProviderStyles';\n\n// String concatenation is used to prevent bundlers to complain with older versions of React\nconst useInsertionEffect = (React as never)['useInsertion' + 'Effect']\n  ? (React as never)['useInsertion' + 'Effect']\n  : useIsomorphicLayoutEffect;\n\nconst createStyleTag = (target: Document | undefined, elementAttributes: Record<string, string>) => {\n  if (!target) {\n    return undefined;\n  }\n\n  const tag = target.createElement('style');\n\n  Object.keys(elementAttributes).forEach(attrName => {\n    tag.setAttribute(attrName, elementAttributes[attrName]);\n  });\n\n  target.head.appendChild(tag);\n  return tag;\n};\n\nconst insertSheet = (tag: HTMLStyleElement, rule: string) => {\n  const sheet = tag.sheet;\n\n  if (sheet) {\n    if (sheet.cssRules.length > 0) {\n      sheet.deleteRule(0);\n    }\n    sheet.insertRule(rule, 0);\n  } else if (process.env.NODE_ENV !== 'production') {\n    // eslint-disable-next-line no-console\n    console.error('FluentProvider: No sheet available on styleTag, styles will not be inserted into DOM.');\n  }\n};\n\n/**\n * Writes a theme as css variables in a style tag on the provided targetDocument as a rule applied to a CSS class\n * @internal\n * @returns CSS class to apply the rule\n */\nexport const useFluentProviderThemeStyleTag = (\n  options: Pick<FluentProviderState, 'theme' | 'targetDocument'> & { rendererAttributes: Record<string, string> },\n) => {\n  const { targetDocument, theme, rendererAttributes } = options;\n\n  const styleTag = React.useRef<HTMLStyleElement | undefined | null>();\n\n  const styleTagId = useId(fluentProviderClassNames.root);\n  const styleElementAttributes = rendererAttributes;\n\n  const cssVarsAsString = React.useMemo(() => {\n    return theme\n      ? (Object.keys(theme) as (keyof typeof theme)[]).reduce((cssVarRule, cssVar) => {\n          cssVarRule += `--${cssVar}: ${theme[cssVar]}; `;\n          return cssVarRule;\n        }, '')\n      : '';\n  }, [theme]);\n\n  const rule = `.${styleTagId} { ${cssVarsAsString} }`;\n\n  useHandleSSRStyleElements(targetDocument, styleTagId);\n  useInsertionEffect(() => {\n    // The style element could already have been created during SSR - no need to recreate it\n    const ssrStyleElement = targetDocument?.getElementById(styleTagId);\n    if (ssrStyleElement) {\n      styleTag.current = ssrStyleElement as HTMLStyleElement;\n    } else {\n      styleTag.current = createStyleTag(targetDocument, { ...styleElementAttributes, id: styleTagId });\n      if (styleTag.current) {\n        insertSheet(styleTag.current, rule);\n      }\n    }\n\n    return () => {\n      styleTag.current?.remove();\n    };\n  }, [styleTagId, targetDocument, rule, styleElementAttributes]);\n\n  return { styleTagId, rule };\n};\n\nfunction useHandleSSRStyleElements(targetDocument: Document | undefined | null, styleTagId: string) {\n  // Using a state factory so that this logic only runs once per render\n  // Each FluentProvider can create its own style element during SSR as a slot\n  // Moves all theme style elements to document head during render to avoid hydration errors.\n  // Should be strict mode safe since the logic is idempotent.\n  React.useState(() => {\n    if (!targetDocument) {\n      return;\n    }\n\n    const themeStyleElement = targetDocument.getElementById(styleTagId);\n    if (themeStyleElement) {\n      targetDocument.head.append(themeStyleElement);\n    }\n  });\n}\n"],"mappings":"AAAA,SAASA,KAAK,EAAEC,yBAAyB,QAAQ;AACjD,YAAYC,KAAA,MAAW;AAGvB,SAASC,wBAAwB,QAAQ;AAEzC;AACA,MAAMC,kBAAA,GAAqBF,KAAgB,CAAC,iBAAiB,SAAS,GAClEA,KAAgB,CAAC,iBAAiB,SAAS,GAC3CD,yBAAyB;AAE7B,MAAMI,cAAA,GAAiBA,CAACC,MAAA,EAA8BC,iBAAA,KAA8C;EAClG,IAAI,CAACD,MAAA,EAAQ;IACX,OAAOE,SAAA;EACT;EAEA,MAAMC,GAAA,GAAMH,MAAA,CAAOI,aAAa,CAAC;EAEjCC,MAAA,CAAOC,IAAI,CAACL,iBAAA,EAAmBM,OAAO,CAACC,QAAA,IAAY;IACjDL,GAAA,CAAIM,YAAY,CAACD,QAAA,EAAUP,iBAAiB,CAACO,QAAA,CAAS;EACxD;EAEAR,MAAA,CAAOU,IAAI,CAACC,WAAW,CAACR,GAAA;EACxB,OAAOA,GAAA;AACT;AAEA,MAAMS,WAAA,GAAcA,CAACT,GAAA,EAAuBU,IAAA,KAAiB;EAC3D,MAAMC,KAAA,GAAQX,GAAA,CAAIW,KAAK;EAEvB,IAAIA,KAAA,EAAO;IACT,IAAIA,KAAA,CAAMC,QAAQ,CAACC,MAAM,GAAG,GAAG;MAC7BF,KAAA,CAAMG,UAAU,CAAC;IACnB;IACAH,KAAA,CAAMI,UAAU,CAACL,IAAA,EAAM;EACzB,OAAO,IAAIM,OAAA,CAAQC,GAAG,CAACC,QAAQ,KAAK,cAAc;IAChD;IACAC,OAAA,CAAQC,KAAK,CAAC;EAChB;AACF;AAEA;;;;;AAKA,OAAO,MAAMC,8BAAA,GACXC,OAAA,IACG;EACH,MAAM;IAAEC,cAAA;IAAgBC,KAAA;IAAOC;EAAkB,CAAE,GAAGH,OAAA;EAEtD,MAAMI,QAAA,GAAWjC,KAAA,CAAMkC,MAAM;EAE7B,MAAMC,UAAA,GAAarC,KAAA,CAAMG,wBAAA,CAAyBmC,IAAI;EACtD,MAAMC,sBAAA,GAAyBL,kBAAA;EAE/B,MAAMM,eAAA,GAAkBtC,KAAA,CAAMuC,OAAO,CAAC,MAAM;IAC1C,OAAOR,KAAA,GACHtB,MAAC,CAAOC,IAAI,CAACqB,KAAA,EAAkCS,MAAM,CAAC,CAACC,UAAA,EAAYC,MAAA,KAAW;MAC5ED,UAAA,IAAe,KAAIC,MAAO,KAAIX,KAAK,CAACW,MAAA,CAAQ,IAAG;MAC/C,OAAOD,UAAA;IACT,GAAG,MACH,EAAE;EACR,GAAG,CAACV,KAAA,CAAM;EAEV,MAAMd,IAAA,GAAQ,IAAGkB,UAAW,MAAKG,eAAgB,IAAG;EAEpDK,yBAAA,CAA0Bb,cAAA,EAAgBK,UAAA;EAC1CjC,kBAAA,CAAmB,MAAM;IACvB;IACA,MAAM0C,eAAA,GAAkBd,cAAA,aAAAA,cAAA,uBAAAA,cAAA,CAAgBe,cAAc,CAACV,UAAA;IACvD,IAAIS,eAAA,EAAiB;MACnBX,QAAA,CAASa,OAAO,GAAGF,eAAA;IACrB,OAAO;MACLX,QAAA,CAASa,OAAO,GAAG3C,cAAA,CAAe2B,cAAA,EAAgB;QAAE,GAAGO,sBAAsB;QAAEU,EAAA,EAAIZ;MAAW;MAC9F,IAAIF,QAAA,CAASa,OAAO,EAAE;QACpB9B,WAAA,CAAYiB,QAAA,CAASa,OAAO,EAAE7B,IAAA;MAChC;IACF;IAEA,OAAO,MAAM;UACX+B,iBAAA;MAAA,CAAAA,iBAAA,GAAAf,QAAA,CAASa,OAAO,cAAhBE,iBAAA,uBAAAA,iBAAA,CAAkBC,MAAA;IACpB;EACF,GAAG,CAACd,UAAA,EAAYL,cAAA,EAAgBb,IAAA,EAAMoB,sBAAA,CAAuB;EAE7D,OAAO;IAAEF,UAAA;IAAYlB;EAAK;AAC5B;AAEA,SAAS0B,0BAA0Bb,cAA2C,EAAEK,UAAkB,EAAE;EAClG;EACA;EACA;EACA;EACAnC,KAAA,CAAMkD,QAAQ,CAAC,MAAM;IACnB,IAAI,CAACpB,cAAA,EAAgB;MACnB;IACF;IAEA,MAAMqB,iBAAA,GAAoBrB,cAAA,CAAee,cAAc,CAACV,UAAA;IACxD,IAAIgB,iBAAA,EAAmB;MACrBrB,cAAA,CAAehB,IAAI,CAACsC,MAAM,CAACD,iBAAA;IAC7B;EACF;AACF"}