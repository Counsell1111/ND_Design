{"version":3,"sources":["../../lib/hooks/useOnClickOutside.js"],"sourcesContent":["import * as React from 'react';\nimport { useEventCallback } from './useEventCallback';\n/**\n * @internal\n * Utility to perform checks where a click/touch event was made outside a component\n */\nexport const useOnClickOutside = options => {\n  const {\n    refs,\n    callback,\n    element,\n    disabled,\n    contains: containsProp\n  } = options;\n  const timeoutId = React.useRef(undefined);\n  useIFrameFocus(options);\n  const listener = useEventCallback(ev => {\n    const contains = containsProp || ((parent, child) => {\n      return !!(parent === null || parent === void 0 ? void 0 : parent.contains(child));\n    });\n    const isOutside = refs.every(ref => !contains(ref.current || null, ev.target));\n    if (isOutside && !disabled) {\n      callback(ev);\n    }\n  });\n  React.useEffect(() => {\n    if (disabled) {\n      return;\n    }\n    // Store the current event to avoid triggering handlers immediately\n    // Note this depends on a deprecated but extremely well supported quirk of the web platform\n    // https://github.com/facebook/react/issues/20074\n    let currentEvent = getWindowEvent(window);\n    const conditionalHandler = event => {\n      // Skip if this event is the same as the one running when we added the handlers\n      if (event === currentEvent) {\n        currentEvent = undefined;\n        return;\n      }\n      listener(event);\n    };\n    // use capture phase because React can update DOM before the event bubbles to the document\n    element === null || element === void 0 ? void 0 : element.addEventListener('click', conditionalHandler, true);\n    element === null || element === void 0 ? void 0 : element.addEventListener('touchstart', conditionalHandler, true);\n    element === null || element === void 0 ? void 0 : element.addEventListener('contextmenu', conditionalHandler, true);\n    // Garbage collect this event after it's no longer useful to avoid memory leaks\n    timeoutId.current = window.setTimeout(() => {\n      currentEvent = undefined;\n    }, 1);\n    return () => {\n      element === null || element === void 0 ? void 0 : element.removeEventListener('click', conditionalHandler, true);\n      element === null || element === void 0 ? void 0 : element.removeEventListener('touchstart', conditionalHandler, true);\n      element === null || element === void 0 ? void 0 : element.removeEventListener('contextmenu', conditionalHandler, true);\n      clearTimeout(timeoutId.current);\n      currentEvent = undefined;\n    };\n  }, [listener, element, disabled]);\n};\nconst getWindowEvent = target => {\n  if (target) {\n    var _target_ownerDocument, _target_ownerDocument_defaultView;\n    if (typeof target.window === 'object' && target.window === target) {\n      // eslint-disable-next-line deprecation/deprecation\n      return target.event;\n    }\n    var _target_ownerDocument_defaultView_event;\n    // eslint-disable-next-line deprecation/deprecation\n    return (_target_ownerDocument_defaultView_event = (_target_ownerDocument = target.ownerDocument) === null || _target_ownerDocument === void 0 ? void 0 : (_target_ownerDocument_defaultView = _target_ownerDocument.defaultView) === null || _target_ownerDocument_defaultView === void 0 ? void 0 : _target_ownerDocument_defaultView.event) !== null && _target_ownerDocument_defaultView_event !== void 0 ? _target_ownerDocument_defaultView_event : undefined;\n  }\n  return undefined;\n};\nconst FUI_FRAME_EVENT = 'fuiframefocus';\n/**\n * Since click events do not propagate past iframes, we use focus to detect if a\n * click has happened inside an iframe, since the only ways of focusing inside an\n * iframe are:\n *   - clicking inside\n *   - tabbing inside\n *\n * Polls the value of `document.activeElement`. If it is an iframe, then dispatch\n * a custom DOM event. When the custom event is received call the provided callback\n */\nconst useIFrameFocus = options => {\n  const {\n    disabled,\n    element: targetDocument,\n    callback,\n    contains: containsProp = (parent, child) => {\n      return !!(parent === null || parent === void 0 ? void 0 : parent.contains(child));\n    },\n    pollDuration = 1000,\n    refs\n  } = options;\n  const timeoutRef = React.useRef();\n  const listener = useEventCallback(e => {\n    const contains = containsProp || ((parent, child) => {\n      return !!(parent === null || parent === void 0 ? void 0 : parent.contains(child));\n    });\n    const isOutside = refs.every(ref => !contains(ref.current || null, e.target));\n    if (isOutside && !disabled) {\n      callback(e);\n    }\n  });\n  // Adds listener to the custom iframe focus event\n  React.useEffect(() => {\n    if (disabled) {\n      return;\n    }\n    targetDocument === null || targetDocument === void 0 ? void 0 : targetDocument.addEventListener(FUI_FRAME_EVENT, listener, true);\n    return () => {\n      targetDocument === null || targetDocument === void 0 ? void 0 : targetDocument.removeEventListener(FUI_FRAME_EVENT, listener, true);\n    };\n  }, [targetDocument, disabled, listener]);\n  // Starts polling for the active element\n  React.useEffect(() => {\n    var _targetDocument_defaultView;\n    if (disabled) {\n      return;\n    }\n    timeoutRef.current = targetDocument === null || targetDocument === void 0 ? void 0 : (_targetDocument_defaultView = targetDocument.defaultView) === null || _targetDocument_defaultView === void 0 ? void 0 : _targetDocument_defaultView.setInterval(() => {\n      const activeElement = targetDocument === null || targetDocument === void 0 ? void 0 : targetDocument.activeElement;\n      if ((activeElement === null || activeElement === void 0 ? void 0 : activeElement.tagName) === 'IFRAME' || (activeElement === null || activeElement === void 0 ? void 0 : activeElement.tagName) === 'WEBVIEW') {\n        const event = new CustomEvent(FUI_FRAME_EVENT, {\n          bubbles: true\n        });\n        activeElement.dispatchEvent(event);\n      }\n    }, pollDuration);\n    return () => {\n      var _targetDocument_defaultView;\n      targetDocument === null || targetDocument === void 0 ? void 0 : (_targetDocument_defaultView = targetDocument.defaultView) === null || _targetDocument_defaultView === void 0 ? void 0 : _targetDocument_defaultView.clearTimeout(timeoutRef.current);\n    };\n  }, [targetDocument, disabled, pollDuration]);\n};\n//# sourceMappingURL=useOnClickOutside.js.map"],"names":["useOnClickOutside","options","refs","callback","element","disabled","contains","containsProp","timeoutId","React","useRef","undefined","useIFrameFocus","listener","useEventCallback","ev","parent","child","isOutside","every","ref","current","target","useEffect","currentEvent","getWindowEvent","window","conditionalHandler","event","addEventListener","setTimeout","removeEventListener","clearTimeout","_target_ownerDocument","_target_ownerDocument_defaultView","_target_ownerDocument_defaultView_event","ownerDocument","defaultView","FUI_FRAME_EVENT","targetDocument","pollDuration","timeoutRef","e","_targetDocument_defaultView","setInterval","activeElement","tagName","CustomEvent","bubbles","dispatchEvent"],"mappings":"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"}