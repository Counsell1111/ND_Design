{"version":3,"names":["React","useEventCallback","useOnClickOutside","options","refs","callback","element","disabled","contains","containsProp","timeoutId","useRef","undefined","useIFrameFocus","listener","ev","parent","child","isOutside","every","ref","current","target","useEffect","currentEvent","getWindowEvent","window","conditionalHandler","event","addEventListener","setTimeout","removeEventListener","clearTimeout","_target_ownerDocument","_target_ownerDocument_defaultView","_target_ownerDocument_defaultView_event","ownerDocument","defaultView","FUI_FRAME_EVENT","targetDocument","pollDuration","timeoutRef","e","_targetDocument_defaultView","setInterval","activeElement","tagName","CustomEvent","bubbles","dispatchEvent"],"sources":["../../src/hooks/useOnClickOutside.ts"],"sourcesContent":["import * as React from 'react';\nimport { useEventCallback } from './useEventCallback';\n\n/**\n * @internal\n */\nexport type UseOnClickOrScrollOutsideOptions = {\n  /**\n   * The element to listen for the click event\n   */\n  element: Document | undefined;\n  /**\n   * Refs to elements that check if the click is outside\n   */\n  refs: React.MutableRefObject<HTMLElement | undefined | null>[];\n\n  /**\n   * By default uses element.contains, but custom contain function can be provided\n   *\n   * @param parent - provided parent element\n   * @param child - event target element\n   */\n  contains?(parent: HTMLElement | null, child: HTMLElement): boolean;\n\n  /**\n   * Disables event listeners\n   */\n  disabled?: boolean;\n\n  /**\n   * Called if the click is outside the element refs\n   */\n  callback: (ev: MouseEvent | TouchEvent) => void;\n};\n\n/**\n * @internal\n * Utility to perform checks where a click/touch event was made outside a component\n */\nexport const useOnClickOutside = (options: UseOnClickOrScrollOutsideOptions) => {\n  const { refs, callback, element, disabled, contains: containsProp } = options;\n  const timeoutId = React.useRef<number | undefined>(undefined);\n  useIFrameFocus(options);\n\n  const listener = useEventCallback((ev: MouseEvent | TouchEvent) => {\n    const contains: UseOnClickOrScrollOutsideOptions['contains'] =\n      containsProp || ((parent, child) => !!parent?.contains(child));\n\n    const isOutside = refs.every(ref => !contains(ref.current || null, ev.target as HTMLElement));\n    if (isOutside && !disabled) {\n      callback(ev);\n    }\n  });\n\n  React.useEffect(() => {\n    if (disabled) {\n      return;\n    }\n\n    // Store the current event to avoid triggering handlers immediately\n    // Note this depends on a deprecated but extremely well supported quirk of the web platform\n    // https://github.com/facebook/react/issues/20074\n    let currentEvent = getWindowEvent(window);\n\n    const conditionalHandler = (event: MouseEvent | TouchEvent) => {\n      // Skip if this event is the same as the one running when we added the handlers\n      if (event === currentEvent) {\n        currentEvent = undefined;\n        return;\n      }\n\n      listener(event);\n    };\n\n    // use capture phase because React can update DOM before the event bubbles to the document\n    element?.addEventListener('click', conditionalHandler, true);\n    element?.addEventListener('touchstart', conditionalHandler, true);\n    element?.addEventListener('contextmenu', conditionalHandler, true);\n\n    // Garbage collect this event after it's no longer useful to avoid memory leaks\n    timeoutId.current = window.setTimeout(() => {\n      currentEvent = undefined;\n    }, 1);\n\n    return () => {\n      element?.removeEventListener('click', conditionalHandler, true);\n      element?.removeEventListener('touchstart', conditionalHandler, true);\n      element?.removeEventListener('contextmenu', conditionalHandler, true);\n\n      clearTimeout(timeoutId.current);\n      currentEvent = undefined;\n    };\n  }, [listener, element, disabled]);\n};\n\nconst getWindowEvent = (target: Node | Window): Event | undefined => {\n  if (target) {\n    if (typeof (target as Window).window === 'object' && (target as Window).window === target) {\n      // eslint-disable-next-line deprecation/deprecation\n      return target.event;\n    }\n\n    // eslint-disable-next-line deprecation/deprecation\n    return (target as Node).ownerDocument?.defaultView?.event ?? undefined;\n  }\n\n  return undefined;\n};\n\nconst FUI_FRAME_EVENT = 'fuiframefocus';\n\ninterface UseIFrameFocusOptions extends UseOnClickOrScrollOutsideOptions {\n  /**\n   * Millisecond duration to poll\n   */\n  pollDuration?: number;\n}\n\n/**\n * Since click events do not propagate past iframes, we use focus to detect if a\n * click has happened inside an iframe, since the only ways of focusing inside an\n * iframe are:\n *   - clicking inside\n *   - tabbing inside\n *\n * Polls the value of `document.activeElement`. If it is an iframe, then dispatch\n * a custom DOM event. When the custom event is received call the provided callback\n */\nconst useIFrameFocus = (options: UseIFrameFocusOptions) => {\n  const {\n    disabled,\n    element: targetDocument,\n    callback,\n    contains: containsProp = (parent, child) => !!parent?.contains(child),\n    pollDuration = 1000,\n    refs,\n  } = options;\n  const timeoutRef = React.useRef<number>();\n\n  const listener = useEventCallback((e: Event) => {\n    const contains = containsProp || ((parent, child) => !!parent?.contains(child));\n\n    const isOutside = refs.every(ref => !contains(ref.current || null, e.target as HTMLElement));\n    if (isOutside && !disabled) {\n      callback(e as MouseEvent);\n    }\n  });\n\n  // Adds listener to the custom iframe focus event\n  React.useEffect(() => {\n    if (disabled) {\n      return;\n    }\n\n    targetDocument?.addEventListener(FUI_FRAME_EVENT, listener, true);\n\n    return () => {\n      targetDocument?.removeEventListener(FUI_FRAME_EVENT, listener, true);\n    };\n  }, [targetDocument, disabled, listener]);\n\n  // Starts polling for the active element\n  React.useEffect(() => {\n    if (disabled) {\n      return;\n    }\n\n    timeoutRef.current = targetDocument?.defaultView?.setInterval(() => {\n      const activeElement = targetDocument?.activeElement;\n\n      if (activeElement?.tagName === 'IFRAME' || activeElement?.tagName === 'WEBVIEW') {\n        const event = new CustomEvent(FUI_FRAME_EVENT, { bubbles: true });\n        activeElement.dispatchEvent(event);\n      }\n    }, pollDuration);\n\n    return () => {\n      targetDocument?.defaultView?.clearTimeout(timeoutRef.current);\n    };\n  }, [targetDocument, disabled, pollDuration]);\n};\n"],"mappings":"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"}